<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="null" language="groovy" pageWidth="148" pageHeight="210" columnWidth="126" leftMargin="11" rightMargin="11" topMargin="11" bottomMargin="11" uuid="04a8737e-0aed-4398-9ef5-e868d0bccd04">
	<property name="ireport.zoom" value="2.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<subDataset name="dataset1" uuid="6945e206-3d0c-4ebb-9494-77c66bfb32e8"/>
	<subDataset name="dataset2" uuid="d6f2af0b-b837-4bb4-8210-f3505699ce1e"/>
	<parameter name="PMI_NO" class="java.lang.String">
		<defaultValueExpression><![CDATA[05134771]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT distinct
     pbd.`PATIENT_NAME` AS pms_patient_biodata_PATIENT_NAME,
     pbd.`NEW_IC_NO` AS pms_patient_biodata_NEW_IC_NO,
     icd_cd.`icd10_desc`  AS diagnosis_Diagnosis,
     IFNULL(lhr_med.`product_name`, 'None') AS lhr_medication_product_name,
     IFNULL(lhr_aller.`allergy_cd`, 'None') AS lhr_allergy_allergy_cd,
     lhr_dia.`Episode_Date` AS lhr_diagnosis_Episode_Date,
     adm_lookup_det.`Description` AS Textuer_Blood_Type,

	CASE WHEN pbd.`NEW_IC_NO`= '-' THEN 'No Record'
            ELSE  pbd.`NEW_IC_NO`  END AS pms_patient_biodata_NEW_IC_NO_new,

	CASE WHEN pbd.`BLOOD_TYPE` = '-' THEN 'No Record'
            ELSE  pbd.`BLOOD_TYPE`  END AS pbd_BLOOD_TYPE_new

FROM `pms_patient_biodata` pbd
inner join lhr_diagnosis lhr_dia
 on pbd.`PMI_NO` = lhr_dia.`PMI_no`
 inner join icd10_codes icd_cd
 on lhr_dia.`Diagnosis_Cd` = icd_cd.`icd10_code` 
 left join adm_lookup_detail adm_lookup_det
 on adm_lookup_det.`Detail_Reference_code` =  pbd.`BLOOD_TYPE`
 and adm_lookup_det.`hfc_cd` = lhr_dia.`hfc_cd`
left join adm_lookup_master adm_lookup_mas
on adm_lookup_det.`Master_Reference_code` = adm_lookup_mas.`Master_Reference_code`
and adm_lookup_mas.`Master_Reference_code` like '0074'
 left join lhr_medication lhr_med
 on pbd.`PMI_NO` = lhr_med.pmi_no 
 and lhr_dia.`Episode_Date` = lhr_med.`Episode_Date`
 left join lhr_allergy lhr_aller
 on pbd.`PMI_NO` =  lhr_aller.pmi_no

WHERE
     pbd.`PMI_NO` = $P{PMI_NO} AND lhr_dia.`Episode_Date` = (SELECT MAX(lhr_dia.`Episode_Date`)
                 FROM `lhr_diagnosis` lhr_dia
                 WHERE lhr_dia.`PMI_no` = $P{PMI_NO})  and 
IF(pbd.`BLOOD_TYPE` != '-',adm_lookup_det.`Master_Reference_code`, '0074') LIKE  '0074']]>
	</queryString>
	<field name="pms_patient_biodata_PATIENT_NAME" class="java.lang.String"/>
	<field name="pms_patient_biodata_NEW_IC_NO" class="java.lang.String"/>
	<field name="diagnosis_Diagnosis" class="java.lang.String"/>
	<field name="lhr_medication_product_name" class="java.lang.String"/>
	<field name="lhr_allergy_allergy_cd" class="java.lang.String"/>
	<field name="lhr_diagnosis_Episode_Date" class="java.sql.Timestamp"/>
	<field name="Textuer_Blood_Type" class="java.lang.String"/>
	<field name="pms_patient_biodata_NEW_IC_NO_new" class="java.lang.String"/>
	<field name="pbd_BLOOD_TYPE_new" class="java.lang.String"/>
	<title>
		<band height="79" splitType="Stretch">
			<staticText>
				<reportElement x="-5" y="45" width="31" height="10" uuid="4e518a14-b1f1-4079-b875-ab23b40e8250"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[IC No:]]></text>
			</staticText>
			<textField>
				<reportElement x="26" y="45" width="89" height="10" uuid="5f58ea11-c2fe-4895-bfe3-10b2fc30ad45"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{pms_patient_biodata_NEW_IC_NO_new}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="-5" y="55" width="31" height="10" uuid="44d0c1db-4019-4d91-b3d2-cd931626c656"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[Name:]]></text>
			</staticText>
			<textField>
				<reportElement x="26" y="55" width="89" height="10" uuid="524b80e3-2ea4-4db2-b72d-df389b59cfb8"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{pms_patient_biodata_PATIENT_NAME}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="-5" y="65" width="41" height="10" uuid="eeda5d93-760e-4cb6-bc38-75d939500048"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[Blood Type:]]></text>
			</staticText>
			<textField>
				<reportElement x="36" y="65" width="79" height="10" uuid="639886f6-c51b-4af0-8ea3-6ec526bc9230"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{pbd_BLOOD_TYPE_new}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="31" y="6" width="72" height="12" uuid="48fa869b-29b1-4a92-aca4-08a8bc1cb72b"/>
				<textElement>
					<font fontName="Arial" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Hospital Serdang]]></text>
			</staticText>
			<staticText>
				<reportElement x="19" y="18" width="98" height="12" uuid="cbb782e0-e2c0-4092-b84c-f8f57c6d4eac"/>
				<textElement>
					<font fontName="Arial" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Satelits Farmasi Daycare]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band height="23" splitType="Stretch">
			<staticText>
				<reportElement x="-4" y="0" width="38" height="10" uuid="11e87861-70a8-4cb5-a60a-536f873ec544"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[Diagnosis:]]></text>
			</staticText>
			<textField>
				<reportElement x="34" y="0" width="82" height="23" uuid="876c3f48-1360-4a59-97d2-a3ef19fa0a72"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{diagnosis_Diagnosis}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="28" splitType="Stretch">
			<staticText>
				<reportElement x="-4" y="3" width="38" height="10" uuid="50797b65-a1e0-4bc4-bd84-e6a5537649e6"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[Medication:]]></text>
			</staticText>
			<textField>
				<reportElement x="34" y="3" width="82" height="21" uuid="7671958b-b19a-4770-b56f-662862d56646"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{lhr_medication_product_name}]]></textFieldExpression>
			</textField>
		</band>
	</columnHeader>
	<detail>
		<band height="21" splitType="Stretch">
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="-4" y="0" width="31" height="10" isPrintInFirstWholeBand="true" uuid="d20de3bc-7e85-4bf1-8102-25ea08cbd545"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[Allergy:]]></text>
			</staticText>
			<textField>
				<reportElement isPrintRepeatedValues="false" x="27" y="0" width="82" height="21" uuid="faabb901-73f2-4d5f-bc45-e696a01c4158"/>
				<textElement>
					<font fontName="Arial" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{lhr_allergy_allergy_cd}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
